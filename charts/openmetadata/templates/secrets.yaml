# Below block is required to create a secret for application once pre-upgrade helm hooks are applied.
---
{{- if not .Values.openmetadata.config.fernetkey.secretRef }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "OpenMetadata.fullname" . }}-db-secret
type: Opaque
data:
{{- with .Values.openmetadata.config }}
  FERNET_KEY: {{ .fernetkey.value | b64enc | quote }}
  DB_HOST: {{ .database.host | b64enc }}
  DB_PORT: {{ .database.port | quote | b64enc }}
  DB_DRIVER_CLASS: {{ .database.driverClass | b64enc }}
  DB_SCHEME: {{ .database.dbScheme | b64enc }}
  OM_DATABASE: {{ .database.databaseName | b64enc }}
  DB_PARAMS: {{ .database.dbParams | b64enc | quote }}
  DB_USER: {{ .database.auth.username | b64enc }}
{{ end }}
{{ end }}

---
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "OpenMetadata.fullname" . }}-search-secret
type: Opaque
data:
{{- with .Values.openmetadata.config.elasticsearch }}
  ELASTICSEARCH_HOST: {{ .host | b64enc }}
  SEARCH_TYPE: {{ .searchType | b64enc }}
  ELASTICSEARCH_PORT: {{ .port | quote | b64enc }}
  ELASTICSEARCH_SCHEME: {{ .scheme | b64enc }}
  ELASTICSEARCH_INDEX_MAPPING_LANG: {{ .searchIndexMappingLanguage | b64enc }}
  ELASTICSEARCH_KEEP_ALIVE_TIMEOUT_SECS: {{ .keepAliveTimeoutSecs | quote | b64enc }}
  {{- if .trustStore.enabled }}
  ELASTICSEARCH_TRUST_STORE_PATH: {{ .trustStore.path | b64enc }}
  {{ end }}
  {{- if .auth.enabled }}
  ELASTICSEARCH_USER: {{ .auth.username | b64enc }}
  {{ end }}
{{ end }}
